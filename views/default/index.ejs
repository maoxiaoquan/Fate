<!--header.ejs start-->
<% include parts/header.ejs %>
<!--header.ejs end-->

<body class="black-theme">

<!--header_view.ejs start-->
<% include parts/header_view.ejs %>
<!--header_view.ejs end-->


<div class="container box-container" id="index">

    <div class="side-menu">
        <!--home-lay layout-type start-->

        <section class="side-menu-view ">

            <div class="recommend-collection">

                <a class="collection" href="/">
                    <span class="collection-name"> 热门</span>
                </a>

                <% data.article_column.forEach(function (item, key) { %>
                <a class="collection <% if(item.article_column_id == data.column_id){ %> active<% } %>"
                   href="/column/<%= item.article_column_id %>">
                    <span class="collection-name"><%= item.article_column_name %></span>
                </a>
                <% }) %>

                <a class="collection" href="/subscribe/tag">
                    <span class="collection-name">
                    更多...
                    </span>
                </a>
            </div>
        </section>
        <!--home-lay layout-type end-->
    </div>

    <div class="row" style="margin-left: 116px">
        <div class="col-xs-12 col-sm-8 col-md-8">

            <% if (data.current_page === 'index'){ %>
            <div id="box-swiper" class="carousel slide box-swiper" data-ride="carousel" style="height: 188px">
                <ol class="carousel-indicators">
                    <li data-target="#box-swiper" data-slide-to="0" class="active"></li>
                    <li data-target="#box-swiper" data-slide-to="1"></li>
                    <li data-target="#box-swiper" data-slide-to="2"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img class="d-block w-100" src="/default/img/88888888.jpg" alt="First slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="/default/img/88888888.jpg" alt="Second slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="/default/img/88888888.jpg" alt="Third slide">
                    </div>
                </div>
                <a class="carousel-control-prev" href="#box-swiper" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#box-swiper" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            <% }else { %>

            <div class="header-top clearfix">
                <div class="header-top-img">
                    <img src="/default/img/list2.png" alt="">
                </div>
                <div class="header-top-view">
                    <h3><%= data.current_page %></h3>
                    <p class="info">别再最该拼搏的年纪选择安逸{{message}}</p>
                </div>
            </div>

            <% } %>
            <!--home-lay layout-content start-->
            <section class="home-lay layout-content">

                <!-- <div class="filter-menu text-center">
                     <button class="active">文章</button>
                     <button data-cid="945">说说</button>
                     <button data-cid="945">视频</button>
                     <button data-cid="945">公告</button>
                 </div>-->

                <ul class="article-list">  <!--第一页默认服务端渲染-->
                    <% data.article_list.forEach(function (item, key) { %>
                    <li>
                        <article class="content-box content-box-index">
                            <div class="info-box">

                                <div class="info-row title-row">
                                    <a href="/article/<%= item.aid %>"
                                       class="title" target="_blank"><%= item.title %></a>
                                </div>

                                <div class="content-text">
                                    <%- item.excerpt %>
                                </div>

                                <div class="info-row meta-row">
                                    <ul class="meta-list">
                                        <li class="item username clickable">
                                            <a href="/user/<%= item.uid %>/article/all"><%= item.author %></a>
                                        </li>
                                        <li class="item item-icon like-article">
                                            <i class="iconfont icon-love"></i>
                                            <strong><%= item.like_count %></strong>
                                        </li>
                                        <li class="item item-icon comment-count">
                                            <i class="iconfont icon-pinglun"></i>
                                            <strong><%= item.comment_count %></strong>
                                        </li>
                                        <li class="item"><%= item.create_at %></li>
                                        <% if(item.tag_ids){ %>
                                        <li class="item">
                                            <% item.tag_ids.split(',').forEach(function (item, key) { %>
                                            <%
                                            data.tag_all.forEach(function (tag_all_item, tag_all_key) {
                                            if (tag_all_item.article_tag_id == item) {
                                            %>
                                            <a class="tag-class frontend"
                                               href="/tag/<%= tag_all_item.article_tag_id %>">
                                                <%= tag_all_item.article_tag_name %>
                                            </a>
                                            <%
                                            }}) %>
                                            <% }) %>
                                        </li>
                                        <% } %>
                                    </ul>
                                </div>
                            </div>
                            <div class="lazy thumb thumb loaded"
                                 style="background-image: url('/default/img/144-144.png'); background-size: cover;">
                            </div>
                        </article>
                    </li>
                    <% }) %>
                    <li v-for="item in article_list"> <!--第一页之后ajax渲染-->
                        <article class="content-box content-box-index">
                            <div class="info-box">

                                <div class="info-row title-row">
                                    <a :href="article_href(item.aid)"
                                       class="title" target="_blank">{{ item.title }}</a>
                                </div>

                                <div class="content-text">
                                    {{item.excerpt}}
                                </div>

                                <div class="info-row meta-row">
                                    <ul class="meta-list">
                                        <li class="item username clickable">
                                            <a href="">{{ item.author }}</a>
                                        </li>
                                        <li class="item item-icon like-article">
                                            <i class="iconfont icon-love"></i>
                                            <strong>{{ item.like_count }}</strong>
                                        </li>
                                        <li class="item item-icon comment-count">
                                            <i class="iconfont icon-pinglun"></i>
                                            <strong>{{ item.comment_count }}</strong>
                                        </li>
                                        <li class="item">{{ item.create_at }}</li>
                                        <li class="item" v-if="item.tag_ids">
                                            <a v-for="item_article_tag in article_tag_filter(item.tag_ids)"
                                               class="tag-class frontend" :href="tag_href(item_article_tag.article_tag_id)">
                                                {{item_article_tag.article_tag_name}}
                                            </a>
                                        </li>
                                    </ul>
                                </div>


                            </div>
                            <div class="lazy thumb thumb loaded"
                                 style="background-image: url('/default/img/144-144.png'); background-size: cover;">
                            </div>
                        </article>
                    </li>
                </ul>


                <div class="article-footer">
                    <button class="reading-more" @click="get_index_article_list" v-if="loading_btn">阅读更多</button>
                    <span class="reading-null" v-else>没有更多...</span>
                </div>

            </section>
            <!--home-lay layout-content end-->


        </div>
        <div class="col-xs-12 col-sm-4 col-md-4">
            <!--aside.ejs start-->
            <% include parts/aside.ejs %>
            <!--aside.ejs end-->
        </div>
    </div>
</div>


<!--footer_view.ejs start-->
<% include parts/footer_view.ejs %>
<!--footer_view.ejs end-->

<script>
  $(function () {

    function page_init () {
      /*recommend-collection*/
      var find_collection_active_length = $('.recommend-collection').find('.active').length
      if (find_collection_active_length === 0) {
        $('.recommend-collection .collection').eq(0).addClass('active')
      }
    }

    page_init()
  })

  new Vue({
    el: '#index',
    data: {
      message: 'Hello Vue!',
      page: 2,
      pageSize: 25,
      column_id: '<%= data.column_id %>',
      tag_all: '',
      article_list: [],
      loading_btn: Number('<%= data.count %>') >= 25
    },
    created: function () {
      /* this.get_index_article_list()*/
    },
    methods: {
      get_index_article_list: function () {
        var params = {
          page: this.page,
          column_id: this.column_id
        }
        var that = this
        _server.get_index_article_list(params).then(function (res) {
          that.$nextTick(function () {
            if (res.data.article_list.length > 0) {
              that.article_list = that.article_list.concat(res.data.article_list)
            }
            if (res.data.article_list.length < that.pageSize) {
              this.loading_btn = false
            } else {
              this.loading_btn = true
            }
            that.article_tag = res.data.article_tag
            that.page = Number(res.data.page) + 1
          })
          console.log('this.article_list', this.article_list)
        })
      },
      article_href: function (val) {
        return '/article/' + val + ''
      },
      tag_href: function (val) {
        return '/tag/' + val + ''
      },
      article_tag_filter: function (val) {
        var _arr = []
        this.article_tag.map(function (item, key) {
          if (val.split(',').indexOf(String(item.article_tag_id)) !== -1) {
            _arr.push(item)
          }
        })
        console.log(_arr)
        return _arr
      }
    }
  })
</script>

<!--<script>

  var navbar = document.getElementById('layout-navbar')

  function getScrollTop () {
    var scrollTop = 0;
    if (document.documentElement && document.documentElement.scrollTop) {
      scrollTop = document.documentElement.scrollTop;
    }
    else if (document.body) {
      scrollTop = document.body.scrollTop;
    }
    return scrollTop;
  }

  window.onscroll = function () {
    var st = getScrollTop()
    if (st > 50) {
      navbar.classList.add("navbar-fixed-top");
    } else {
      navbar.classList.remove("navbar-fixed-top");
    }
  }

</script>-->

</body>

<% include parts/footer.ejs %>