<!--header.html start-->
<% include parts/header.html %>
<!--header.html end-->

<body class="black-theme">

<!--header_view.html start-->
<% include parts/header_view.html %>
<!--header_view.html end-->


<div class="index-container box-container" id="index">

    <div class="side-menu">
        <div class="recommend-collection">
            <a class="collection" href="/">
                <span class="collection-name"> 热门</span>
            </a>
            <% data.article_column.forEach(function (item, key) { %>
            <a class="collection <% if(item.article_column_id == data.column_id){ %> active <% } %>"
               href="/column/<%= item.article_column_id %>">
                <i class="iconfont icon-guanji"></i>
                <span class="collection-name"><%= item.article_column_name %></span>
            </a>
            <% }) %>
            <a class="collection" href="/subscribe/tag">
                            <span class="collection-name">
                              更多...
                            </span>
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 col-sm-8 col-md-8">

            <% if (data.current_page === 'index'){ %>
            <div id="box-swiper" class="carousel slide box-swiper" data-ride="carousel">
                <img src="/default/img/666.png" alt="">
            </div>
            <% }else { %>

            <div class="header-top clearfix">
                <div class="header-top-img">
                    <img src="/default/img/list2.png" alt="">
                </div>
                <div class="header-top-view">
                    <h3>
                        <%= data.current_page %>
                    </h3>
                    <p class="info">别再最该拼搏的年纪选择安逸{{message}}</p>
                </div>
            </div>

            <% } %>
            <!--home-lay layout-content start-->
            <section class="home-lay layout-content">

                <!-- <div class="filter-menu text-center">
                           <button class="active">文章</button>
                           <button data-cid="945">说说</button>
                           <button data-cid="945">视频</button>
                           <button data-cid="945">公告</button>
                       </div>-->

                <ul class="article-list">
                    <!--第一页默认服务端渲染-->
                    <% data.article_list.forEach(function (item, key) { %>
                    <li>
                        <article class="content-box content-box-index">
                            <div class="info-box">

                                <div class="info-row title-row">
                                    <a href="/article/<%= item.aid %>" class="title" target="_blank">
                                        <%= item.title %></a>
                                </div>

                                <div class="content-text">
                                    <%- item.excerpt %>
                                </div>

                                <div class="info-row meta-row">
                                    <ul class="meta-list">
                                        <li class="item username clickable">
                                            <a href="/user/<%= item.uid %>/article/all">
                                                <%= item.user.nickname %></a>
                                        </li>
                                        <li class="item item-icon like-article">
                                            <i class="iconfont icon-love"></i>
                                            <strong>
                                                <%= item.like_count %></strong>
                                        </li>
                                        <li class="item item-icon comment-count">
                                            <i class="iconfont icon-pinglun"></i>
                                            <strong>
                                                <%= item.comment_count %></strong>
                                        </li>
                                        <li class="item">
                                            <%= item.create_at %>
                                        </li>
                                        <% if(item.tag_ids){ %>
                                        <li class="item">
                                            <% item.tag_ids.split(',').forEach(function (item, key) { %>
                                            <%
                                            data.tag_all.forEach(function (tag_all_item, tag_all_key) {
                                            if (tag_all_item.article_tag_id == item) {
                                            %>
                                            <a class="tag-class frontend"
                                               href="/tag/<%= tag_all_item.article_tag_id %>">
                                                <%= tag_all_item.article_tag_name %>
                                            </a>
                                            <%
                                            }}) %>
                                            <% }) %>
                                        </li>
                                        <% } %>
                                    </ul>
                                </div>
                            </div>
                            <% if(item.cover_img){ %>
                            <div class="lazy thumb thumb loaded"
                                 style="background-image: url('<%= item.cover_img %>'); background-size: cover;">
                            </div>
                            <% } %>
                        </article>
                    </li>
                    <% }) %>
                    <li v-for="item in article_list">
                        <!--第一页之后ajax渲染-->
                        <article class="content-box content-box-index">
                            <div class="info-box">

                                <div class="info-row title-row">
                                    <a :href="article_href(item.aid)" class="title" target="_blank">{{ item.title }}</a>
                                </div>

                                <div class="content-text">
                                    {{item.excerpt}}
                                </div>

                                <div class="info-row meta-row">
                                    <ul class="meta-list">
                                        <li class="item username clickable">
                                            <a href="">{{ item.user.nickname }}</a>
                                        </li>
                                        <li class="item item-icon like-article">
                                            <i class="iconfont icon-love"></i>
                                            <strong>{{ item.like_count }}</strong>
                                        </li>
                                        <li class="item item-icon comment-count">
                                            <i class="iconfont icon-pinglun"></i>
                                            <strong>{{ item.comment_count }}</strong>
                                        </li>
                                        <li class="item">{{ item.create_at }}</li>
                                        <li class="item" v-if="item.tag_ids">
                                            <a v-for="item_article_tag in article_tag_filter(item.tag_ids)"
                                               class="tag-class frontend"
                                               :href="tag_href(item_article_tag.article_tag_id)">
                                                {{item_article_tag.article_tag_name}}
                                            </a>
                                        </li>
                                    </ul>
                                </div>


                            </div>
                            <div class="lazy thumb thumb loaded" v-if="item.cover_img" style="background-size: cover;"
                                 :style="{'background-image':'url('+item.cover_img+')'}">
                            </div>
                        </article>
                    </li>
                </ul>


                <div class="article-footer">
                    <button class="reading-more" @click="get_index_article_list" v-if="loading_btn">阅读更多</button>
                    <span class="reading-null" v-else>没有更多...</span>
                </div>

            </section>
            <!--home-lay layout-content end-->


        </div>
        <div class="col-xs-12 col-sm-4 col-md-4">
            <!--aside.html start-->
            <% include parts/aside.html %>
            <!--aside.html end-->
        </div>
    </div>
</div>


<script>
  new Vue({
    el: '#index',
    data: {
      message: 'Hello Vue!',
      page: 2,
      pageSize: 25,
      column_id: '<%= data.column_id %>',
      tag_all: '',
      article_list: [],
      loading_btn: Number('<%= data.count %>') >= 25
    },
    created: function () {
      /* this.get_index_article_list()*/
    },
    methods: {
      get_index_article_list: function () {
        var params = {
          page: this.page,
          column_id: this.column_id
        }
        var that = this
        _server.get_index_article_list(params).then(function (res) {
          that.$nextTick(function () {
            if (res.data.article_list.length > 0) {
              that.article_list = that.article_list.concat(res.data.article_list)
            }
            if (res.data.article_list.length < that.pageSize) {
              this.loading_btn = false
            } else {
              this.loading_btn = true
            }
            that.article_tag = res.data.article_tag
            that.page = Number(res.data.page) + 1
          })
          console.log('this.article_list', this.article_list)
        })
      },
      article_href: function (val) {
        return '/article/' + val + ''
      },
      tag_href: function (val) {
        return '/tag/' + val + ''
      },
      article_tag_filter: function (val) {
        var _arr = []
        this.article_tag.map(function (item, key) {
          if (val.split(',').indexOf(String(item.article_tag_id)) !== -1) {
            _arr.push(item)
          }
        })
        console.log(_arr)
        return _arr
      }
    }
  })
</script>

<!--<script>

var navbar = document.getElementById('layout-navbar')

function getScrollTop () {
  var scrollTop = 0;
  if (document.documentElement && document.documentElement.scrollTop) {
    scrollTop = document.documentElement.scrollTop;
  }
  else if (document.body) {
    scrollTop = document.body.scrollTop;
  }
  return scrollTop;
}

window.onscroll = function () {
  var st = getScrollTop()
  if (st > 50) {
    navbar.classList.add("navbar-fixed-top");
  } else {
    navbar.classList.remove("navbar-fixed-top");
  }
}

</script>-->

</body>

<% include parts/footer.html %>
